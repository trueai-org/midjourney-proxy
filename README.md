# Midjourney Proxy

**ä¸­æ–‡** | [English](README.en.md)

ä»£ç† Midjourney çš„ Discord é¢‘é“ï¼Œå®ç° API å½¢å¼è°ƒç”¨ AI ç»˜å›¾ï¼Œå…¬ç›Šé¡¹ç›®ï¼Œæä¾›ç»˜å›¾ API å…è´¹ä½¿ç”¨ã€‚

å®Œå…¨å¼€æºï¼Œä¸ä¼šå­˜åœ¨éƒ¨åˆ†å¼€æºæˆ–éƒ¨åˆ†é—­æºï¼Œæ¬¢è¿ PRã€‚

åŠŸèƒ½æœ€å…¨ã€æœ€å®‰å…¨ã€å ç”¨å†…å­˜æœ€å°ï¼ˆ100MB+ï¼‰çš„ Midjourney Proxy API ~~

## ä¸»è¦åŠŸèƒ½

- [x] æ”¯æŒ Imagine æŒ‡ä»¤å’Œç›¸å…³åŠ¨ä½œ [V1/V2.../U1/U2.../R]
- [x] Imagine æ—¶æ”¯æŒæ·»åŠ å›¾ç‰‡ base64ï¼Œä½œä¸ºå«å›¾
- [x] æ”¯æŒ Blend (å›¾ç‰‡æ··åˆ)ã€Describe (å›¾ç”Ÿæ–‡) æŒ‡ä»¤
- [x] æ”¯æŒä»»åŠ¡å®æ—¶è¿›åº¦
- [x] æ”¯æŒä¸­æ–‡ prompt ç¿»è¯‘ï¼Œéœ€é…ç½®ç™¾åº¦ç¿»è¯‘
- [x] prompt æ•æ„Ÿè¯é¢„æ£€æµ‹ï¼Œæ”¯æŒè¦†ç›–è°ƒæ•´
- [x] user-token è¿æ¥ wssï¼Œå¯ä»¥è·å–é”™è¯¯ä¿¡æ¯å’Œå®Œæ•´åŠŸèƒ½
- [x] æ”¯æŒ Shorten(promptåˆ†æ) æŒ‡ä»¤
- [x] æ”¯æŒç„¦ç‚¹ç§»åŠ¨ï¼šPan â¬…ï¸â¡â¬†ï¸â¬‡ï¸
- [x] æ”¯æŒå±€éƒ¨é‡ç»˜ï¼šVary (Region) ğŸ–Œ
- [x] æ”¯æŒå‡ ä¹æ‰€æœ‰çš„å…³è”æŒ‰é’®åŠ¨ä½œå’Œ ğŸ›ï¸ Remix æ¨¡å¼
- [x] æ”¯æŒå›¾ç‰‡å˜ç„¦ï¼Œè‡ªå®šä¹‰å˜ç„¦ Zoom ğŸ”
- [x] æ”¯æŒè·å–å›¾ç‰‡çš„ seed å€¼
- [x] æ”¯æŒè´¦å·æŒ‡å®šç”Ÿæˆé€Ÿåº¦æ¨¡å¼ RELAX | FAST | TURBO 
- [x] æ”¯æŒå¤šè´¦å·é…ç½®ï¼Œæ¯ä¸ªè´¦å·å¯è®¾ç½®å¯¹åº”çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ”¯æŒè´¦å·é€‰æ‹©æ¨¡å¼ BestWaitIdle | Random | Weight | Polling
- [x] è´¦å·æ± æŒä¹…åŒ–ï¼ŒåŠ¨æ€ç»´æŠ¤
- [x] æ”¯æŒè·å–è´¦å· /infoã€/settings ä¿¡æ¯
- [x] è´¦å· settings è®¾ç½®
- [x] æ”¯æŒ nijiãƒ»journey Bot å’Œ Midjourney Bot
- [x] zlib-stream å®‰å…¨å‹ç¼©ä¼ è¾“ <https://discord.com/developers/docs/topics/gateway>
- [x] å†…åµŒMJç®¡ç†åå°é¡µé¢ï¼Œæ”¯æŒå¤šè¯­è¨€ <https://github.com/trueai-org/midjourney-proxy-webui>
- [x] æ”¯æŒMJè´¦å·çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½
- [x] æ”¯æŒMJè´¦å·çš„è¯¦ç»†ä¿¡æ¯æŸ¥è¯¢å’Œè´¦å·åŒæ­¥æ“ä½œ
- [x] æ”¯æŒMJè´¦å·çš„å¹¶å‘é˜Ÿåˆ—è®¾ç½®
- [x] æ”¯æŒMJçš„è´¦å·settingsè®¾ç½®
- [x] æ”¯æŒMJçš„ä»»åŠ¡æŸ¥è¯¢
- [x] æä¾›åŠŸèƒ½é½å…¨çš„ç»˜å›¾æµ‹è¯•é¡µé¢
- [x] å…¼å®¹æ”¯æŒå¸‚é¢ä¸Šä¸»æµç»˜å›¾å®¢æˆ·ç«¯å’Œ API è°ƒç”¨ã€‚

## åœ¨çº¿é¢„è§ˆ

å…¬ç›Šæ¥å£ä¸ºæ…¢é€Ÿæ¨¡å¼ï¼Œæ¥å£å…è´¹è°ƒç”¨ï¼Œè´¦å·æ± ç”±èµåŠ©è€…æä¾›ï¼Œè¯·å¤§å®¶åˆç†ä½¿ç”¨ã€‚

- ç®¡ç†åå°ï¼š<https://ai.trueai.org>
- è´¦å·å¯†ç ï¼š`æ— `
- å…¬ç›Šæ¥å£ï¼š<https://ai.trueai.org/mj>
- æ¥å£æ–‡æ¡£ï¼š<https://ai.trueai.org/swagger>
- æ¥å£å¯†é’¥ï¼š`æ— `

## é¢„è§ˆæˆªå›¾

![æ¬¢è¿](./docs/screenshots/ui1.png)

![è´¦å·](./docs/screenshots/ui2.png)

![ä»»åŠ¡](./docs/screenshots/ui3.png)

![æµ‹è¯•](./docs/screenshots/ui4.png)

![æ—¥å¿—](./docs/screenshots/ui5.png)

![æ¥å£](./docs/screenshots/uiswagger.png)

## å®¢æˆ·ç«¯æ¨è

- **ChatGPT Web Midjourney Proxy**: <https://github.com/Dooy/chatgpt-web-midjourney-proxy> 
  - æ‰“å¼€ç½‘ç«™ <https://vercel.ddaiai.com> -> è®¾ç½® -> MJ ç»˜ç”»æ¥å£åœ°å€ -> <https://ai.trueai.org>

- **GoAmzAI**: <https://github.com/Licoy/GoAmzAI>
  -	æ‰“å¼€åå° -> ç»˜ç”»ç®¡ç† -> æ–°å¢ -> MJ ç»˜ç”»æ¥å£åœ°å€ -> <https://ai.trueai.org/mj>

## å®‰è£…ä¸ä½¿ç”¨

### å¿«é€Ÿå¯åŠ¨

> Docker ç‰ˆæœ¬

```bash
# é˜¿é‡Œäº‘é•œåƒï¼ˆæ¨èå›½å†…ä½¿ç”¨ï¼‰
docker pull registry.cn-guangzhou.aliyuncs.com/trueai-org/midjourney-proxy

# å…¬ç›Šæ¼”ç¤ºç«™ç‚¹å¯åŠ¨é…ç½®ç¤ºä¾‹
docker stop mjopen && docker rm mjopen
docker run --name mjopen -d --restart=always \
 -e DEMO=true \
 -p 8086:8080 --user root \
 -v /root/mjopen/logs:/app/logs:rw \
 -v /root/mjopen/data:/app/data:rw \
 -v /root/mjopen/appsettings.Production.json:/app/appsettings.Production.json:ro \
 -e TZ=Asia/Shanghai \
 -v /etc/localtime:/etc/localtime:ro \
 -v /etc/timezone:/etc/timezone:ro \
 registry.cn-guangzhou.aliyuncs.com/trueai-org/midjourney-proxy

# ç”Ÿäº§ç¯å¢ƒå¯åŠ¨é…ç½®ç¤ºä¾‹
docker run --name mjproxy -d --restart=always \
 -p 8088:8080 --user root \
 -v /root/mjproxy/logs:/app/logs:rw \
 -v /root/mjproxy/data:/app/data:rw \
 -v /root/mjproxy/appsettings.Production.json:/app/appsettings.Production.json:ro \
 -e TZ=Asia/Shanghai \
 -v /etc/localtime:/etc/localtime:ro \
 -v /etc/timezone:/etc/timezone:ro \
 registry.cn-guangzhou.aliyuncs.com/trueai-org/midjourney-proxy
```

> Windows ç‰ˆæœ¬

```bash
a. é€šè¿‡ https://github.com/trueai-org/midjourney-proxy/releases ä¸‹è½½ windows æœ€æ–°å…å®‰è£…ç‰ˆï¼Œä¾‹å¦‚ï¼šmidjourney-proxy-win-x64.zip
b. è§£å‹å¹¶æ‰§è¡Œ Midjourney.API.exe
c. æ‰“å¼€ç½‘ç«™ http://localhost:8080
d. éƒ¨ç½²åˆ° IISï¼ˆå¯é€‰ï¼‰ï¼Œåœ¨ IIS æ·»åŠ ç½‘ç«™ï¼Œå°†æ–‡ä»¶å¤¹éƒ¨ç½²åˆ° IISï¼Œé…ç½®åº”ç”¨ç¨‹åºæ± ä¸º`æ— æ‰˜ç®¡ä»£ç `ï¼Œå¯åŠ¨ç½‘ç«™ã€‚
e. ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„ `ä»»åŠ¡è®¡åˆ’ç¨‹åº`ï¼ˆå¯é€‰ï¼‰ï¼Œåˆ›å»ºåŸºæœ¬ä»»åŠ¡ï¼Œé€‰æ‹© `.exe` ç¨‹åºå³å¯ï¼Œè¯·é€‰æ‹©`è¯·å‹¿å¯åŠ¨å¤šä¸ªå®ä¾‹`ï¼Œä¿è¯åªæœ‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå³å¯ã€‚
```

> Linux ç‰ˆæœ¬

```bash
a. é€šè¿‡ https://github.com/trueai-org/midjourney-proxy/releases ä¸‹è½½ linux æœ€æ–°å…å®‰è£…ç‰ˆï¼Œä¾‹å¦‚ï¼šmidjourney-proxy-linux-x64.zip
b. è§£å‹åˆ°å½“å‰ç›®å½•: tar -xzf midjourney-proxy-linux-x64-<VERSION>.tar.gz
c. æ‰§è¡Œ: run_app.sh
c. å¯åŠ¨æ–¹å¼1: sh run_app.sh
d. å¯åŠ¨æ–¹å¼2: chmod +x run_app.sh && ./run_app.sh
```
> macOS ç‰ˆæœ¬

```bash
a. é€šè¿‡ https://github.com/trueai-org/midjourney-proxy/releases ä¸‹è½½ macOS æœ€æ–°å…å®‰è£…ç‰ˆï¼Œä¾‹å¦‚ï¼šmidjourney-proxy-osx-x64.zip
b. è§£å‹åˆ°å½“å‰ç›®å½•: tar -xzf midjourney-proxy-osx-x64-<VERSION>.tar.gz
c. æ‰§è¡Œ: run_app_osx.sh
c. å¯åŠ¨æ–¹å¼1: sh run_app_osx.sh
d. å¯åŠ¨æ–¹å¼2: chmod +x run_app_osx.sh && ./run_app_osx.sh
```

## å‚æ•°é…ç½®

- `appsettings.json` é»˜è®¤é…ç½®
- `appsettings.Production.json` ç”Ÿäº§ç¯å¢ƒé…ç½®
- `/app/data` æ•°æ®ç›®å½•ï¼Œå­˜æ”¾è´¦å·ã€ä»»åŠ¡ç­‰æ•°æ®
    - `/app/data/mj.db` æ•°æ®åº“æ–‡ä»¶
- `/app/logs` æ—¥å¿—ç›®å½•

```json
{
  "Demo": null, // ç½‘ç«™é…ç½®ä¸ºæ¼”ç¤ºæ¨¡å¼
  "UserToken": "", // ç”¨æˆ·ç»˜ç”»ä»¤ç‰Œ tokenï¼Œå¯ä»¥ç”¨æ¥è®¿é—®ç»˜ç”»æ¥å£ï¼Œå¯ä»¥ä¸ç”¨è®¾å®š
  "AdminToken": "", // ç®¡ç†åå°ä»¤ç‰Œ tokenï¼Œå¯ä»¥ç”¨æ¥è®¿é—®ç»˜ç”»æ¥å£å’Œç®¡ç†å‘˜è´¦å·ç­‰åŠŸèƒ½
  "mj": {
    "AccountChooseRule": "BestWaitIdle", // BestWaitIdle | Random | Weight | Polling = æœ€ä½³ç©ºé—²è§„åˆ™ | éšæœº | æƒé‡ | è½®è¯¢
    "Discord": { // Discord é…ç½®ï¼Œé»˜è®¤å¯ä»¥ä¸º null
      "GuildId": "125652671***", // æœåŠ¡å™¨ ID
      "ChannelId": "12565267***", // é¢‘é“ ID
      "PrivateChannelId": "1256495659***", // MJ ç§ä¿¡é¢‘é“ IDï¼Œç”¨æ¥æ¥å— seed å€¼
      "NijiBotChannelId": "1261608644***", // NIJI ç§ä¿¡é¢‘é“ IDï¼Œç”¨æ¥æ¥å— seed å€¼
      "UserToken": "MTI1NjQ5N***", // ç”¨æˆ· token
      "BotToken": "MTI1NjUyODEy***", // æœºå™¨äºº token
      "UserAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.0.0 Safari/537.36",
      "Enable": true, // æ˜¯å¦é»˜è®¤å¯åŠ¨
      "CoreSize": 3, // å¹¶å‘æ•°
      "QueueSize": 10, // é˜Ÿåˆ—æ•°
      "MaxQueueSize": 100, // æœ€å¤§é˜Ÿåˆ—æ•°
      "TimeoutMinutes": 5, // ä»»åŠ¡è¶…æ—¶åˆ†é’Ÿæ•°
      "Mode": null, // RELAX | FAST | TURBO æŒ‡å®šç”Ÿæˆé€Ÿåº¦æ¨¡å¼ --fast, --relax, or --turbo parameter at the end.
      "Weight": 1 // æƒé‡
    },
    "NgDiscord": { // NG Discord é…ç½®ï¼Œé»˜è®¤å¯ä»¥ä¸º null
      "Server": "",
      "Cdn": "",
      "Wss": "",
      "ResumeWss": "",
      "UploadServer": ""
    },
    "Proxy": { // ä»£ç†é…ç½®ï¼Œé»˜è®¤å¯ä»¥ä¸º null
      "Host": "",
      "Port": 10809
    },
    "Accounts": [], // è´¦å·æ± é…ç½®
    "BaiduTranslate": { // ç™¾åº¦ç¿»è¯‘é…ç½®ï¼Œé»˜è®¤å¯ä»¥ä¸º null
      "Appid": "", // your_appid
      "AppSecret": "" // your_app_secret
    },
    "TranslateWay": "NULL", // NULL | GTP | BAIDU, ç¿»è¯‘é…ç½®, é»˜è®¤: NULL
    "ApiSecret": "", // your_api_secret
    "NotifyHook": "", // your_notify_hook, å›è°ƒé…ç½®
    "NotifyPoolSize": 10
  },
  "Serilog": {
    "MinimumLevel": {
      "Default": "Information",
      "Override": {
        "Default": "Warning",
        "System": "Warning",
        "Microsoft": "Warning"
      }
    },
    "WriteTo": [
      {
        "Name": "File",
        "Args": {
          "path": "logs/log.txt",
          "rollingInterval": "Day",
          "fileSizeLimitBytes": null,
          "rollOnFileSizeLimit": false,
          "retainedFileCountLimit": 31
        }
      },
      {
        "Name": "Console"
      }
    ]
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*",
  "urls": "http://*:8080" // é»˜è®¤ç«¯å£
}
```

> é…ç½®ä½¿ç”¨

å¯åŠ¨ docker åï¼Œé…ç½®ä»£ç†ä¸º `http://127.0.0.1:8086/mj` å³å¯

![ç¤ºä¾‹](./docs/screenshots/chrome_EDzoztHa2b.png)

## æœºå™¨äºº Tokenï¼ˆå¿…é¡»é…ç½®ï¼‰

æœ¬é¡¹ç›®åˆ©ç”¨ Discord æœºå™¨äºº Token è¿æ¥ wssï¼Œå¯ä»¥è·å–é”™è¯¯ä¿¡æ¯å’Œå®Œæ•´åŠŸèƒ½ï¼Œç¡®ä¿æ¶ˆæ¯çš„é«˜å¯ç”¨æ€§ç­‰é—®é¢˜ã€‚

```
1. åˆ›å»ºåº”ç”¨
https://discord.com/developers/applications

2. è®¾ç½®åº”ç”¨æƒé™ï¼ˆç¡®ä¿æ‹¥æœ‰è¯»å–å†…å®¹æƒé™ï¼Œå‚è€ƒæˆªå›¾ï¼‰
[Bot] è®¾ç½® -> å…¨éƒ¨å¼€å¯

3. æ·»åŠ åº”ç”¨åˆ°é¢‘é“æœåŠ¡å™¨ï¼ˆå‚è€ƒæˆªå›¾ï¼‰

client_id å¯ä»¥åœ¨åº”ç”¨è¯¦æƒ…é¡µæ‰¾åˆ°ï¼Œä¸º APPLICATION ID

https://discord.com/oauth2/authorize?client_id=xxx&permissions=8&scope=bot

4. å¤åˆ¶æˆ–é‡ç½® Bot Token åˆ°é…ç½®æ–‡ä»¶
```

è®¾ç½®åº”ç”¨æƒé™ï¼ˆç¡®ä¿æ‹¥æœ‰è¯»å–å†…å®¹æƒé™ï¼Œå‚è€ƒæˆªå›¾ï¼‰

![è®¾ç½®åº”ç”¨æƒé™](./docs/screenshots/gjODn5Nplq.png)

æ·»åŠ åº”ç”¨åˆ°é¢‘é“æœåŠ¡å™¨ï¼ˆå‚è€ƒæˆªå›¾ï¼‰

![æ·»åŠ åº”ç”¨åˆ°é¢‘é“æœåŠ¡å™¨](./docs/screenshots/ItiWgaWIaX.png)

## ç›¸å…³æ–‡æ¡£
1. [APIæ¥å£è¯´æ˜](./docs/api.md)

## æ”¯æŒä¸èµåŠ©

- å¦‚æœè§‰å¾—è¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œè¯·å¸®å¿™ç‚¹ä¸ª Starâ­
- æ‚¨ä¹Ÿå¯ä»¥æä¾›æš‚æ—¶ä¸ç”¨çš„ç»˜ç”»å…¬ç›Šè´¦å·ï¼Œæ”¯æŒæ­¤é¡¹ç›®çš„å‘å±•ğŸ˜€

## å‹æƒ…é“¾æ¥

- https://github.com/dolfies/discord.py-self
- https://github.com/bao-io/midjourney-sdk
- https://github.com/webman-php/midjourney-proxy
- https://github.com/novicezk/midjourney-proxy
- https://github.com/litter-coder/midjourney-proxy-plus
- https://github.com/Dooy/chatgpt-web-midjourney-proxy
- https://github.com/erictik/midjourney-api
- https://github.com/yokonsan/midjourney-api
- https://github.com/imagineapi/imagineapi

## å¸¸ç”¨é“¾æ¥
- Open AIå®˜ç½‘: <https://openai.com>
- Discordå®˜ç½‘: <https://discord.com>
- Discordå¼€æ”¾å¹³å°: <https://discord.com/developers/applications>
- æ–‡å¿ƒä¸€è¨€å®˜ç½‘: <https://cloud.baidu.com/product/wenxinworkshop>
- æ˜Ÿç«æ¨¡å‹å®˜ç½‘: <https://xinghuo.xfyun.cn/>
- Api2då®˜ç½‘: <https://api2d.com/>
- OpenAI-SBå®˜ç½‘: <https://www.openai-sb.com>
- å®å¡”å®˜ç½‘: <https://bt.cn>
- é˜¿é‡Œäº‘å®˜ç½‘: <https://aliyun.com>
- è…¾è®¯äº‘å®˜ç½‘: <https://cloud.tencent.com/>
- çŸ­ä¿¡å®å®˜ç½‘: <http://www.smsbao.com/>
- OneAPIé¡¹ç›®: <https://github.com/songquanpeng/one-api>